!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("fs"),require("@angular/core"),require("@angular/compiler"),require("@angular/platform-server"),require("@nguniversal/hapi-engine/tokens")):"function"==typeof define&&define.amd?define("@nguniversal/hapi-engine",["exports","fs","@angular/core","@angular/compiler","@angular/platform-server","@nguniversal/hapi-engine/tokens"],r):r(((e=e||self).nguniversal=e.nguniversal||{},e.nguniversal.hapiEngine={}),e.fs,e.ng.core,e.ng.compiler,e.ng.platformServer,e.nguniversal.hapiEngine.tokens)}(this,function(e,r,n,o,i,t){"use strict";
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */var u=function(){function e(){}return e.prototype.get=function(e){return new Promise(function(n,o){r.readFile(e,function(e,r){if(e)return o(e);n(r.toString())})})},e}(),a={},s=new Map;
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */function l(e){return a[e]=a[e]||r.readFileSync(e).toString()}
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */e.ngHapiEngine=function c(e){var r=e.req,a=i.platformDynamicServer().injector.get(n.CompilerFactory).createCompiler([{providers:[{provide:o.ResourceLoader,useClass:u,deps:[]}]}]);if(void 0===r.raw.req.url)return Promise.reject(new Error("url is undefined"));var c=r.raw.req.url,p=r.server.info.protocol+"://"+r.info.host+r.path;return e.providers=e.providers||[],new Promise(function(r,o){var u=e.bootstrap;if(!u)return o(new Error("You must pass in a NgModule or NgModuleFactory to be bootstrapped"));var f=e.providers.concat(e.providers,function d(e){var r=[{provide:t.REQUEST,useValue:e}];return r.push({provide:t.RESPONSE,useValue:e.raw.res}),r}(e.req),[{provide:i.INITIAL_CONFIG,useValue:{document:e.document||l(c),url:e.url||p}}]);(function g(e,r){return new Promise(function(o,i){if(e instanceof n.NgModuleFactory)o(e);else{var t=s.get(e);t?o(t):r.compileModuleAsync(e).then(function(r){s.set(e,r),o(r)},i)}})})(u,a).then(function(e){return i.renderModuleFactory(e,{extraProviders:f})}).then(r,o)})},Object.defineProperty(e,"__esModule",{value:!0})});