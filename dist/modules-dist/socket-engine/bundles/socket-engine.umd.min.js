!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("tslib"),require("fs"),require("@angular/compiler"),require("@angular/core"),require("@angular/platform-server"),require("net")):"function"==typeof define&&define.amd?define("@nguniversal/socket-engine",["exports","tslib","fs","@angular/compiler","@angular/core","@angular/platform-server","net"],r):r(((e=e||self).nguniversal=e.nguniversal||{},e.nguniversal.socketEngine={}),e.tslib,e.fs,e.ng.compiler,e.ng.core,e.ng.platformServer,e.net)}(this,function(e,r,t,n,o,i,a){"use strict";
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */var s=function(){function e(){}return e.prototype.get=function(e){return new Promise(function(r,n){t.readFile(e,function(e,t){if(e)return n(e);r(t.toString())})})},e}(),u=new o.InjectionToken("SERVER_CONTEXT"),c=function(){function e(e,r){void 0===r&&(r=[]),this.moduleOrFactory=e,this.providers=r,this.factoryCacheMap=new Map,this.templateCache={}}return e.prototype.getCompiler=function(){return i.platformDynamicServer().injector.get(o.CompilerFactory).createCompiler([{providers:[{provide:n.ResourceLoader,useClass:s,deps:[]}]}])},e.prototype.render=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,n,o,a;return r.__generator(this,function(s){switch(s.label){case 0:return(n=e.document)?[3,2]:[4,this.getDocument(e.documentFilePath)];case 1:n=s.sent(),s.label=2;case 2:return t=n,o=r.__spread(e.providers||[],this.providers||[],[{provide:u,useValue:JSON.parse(e.context)},{provide:i.INITIAL_CONFIG,useValue:{document:t,url:e.url}}]),[4,this.getFactory()];case 3:return a=s.sent(),[2,i.renderModuleFactory(a,{extraProviders:o})]}})})},e.prototype.getFactory=function(){var e=this,r=this.moduleOrFactory;if(r instanceof o.NgModuleFactory)return Promise.resolve(r);var t=this.factoryCacheMap.get(r);return t?Promise.resolve(t):this.getCompiler().compileModuleAsync(r).then(function(t){return e.factoryCacheMap.set(r,t),t})},e.prototype.getDocument=function(e){var r=this.templateCache[e]=this.templateCache[e]||t.readFileSync(e).toString();return Promise.resolve(r)},e}();
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
e.startSocketEngine=
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
function l(e,t,n,o){var i=this;return void 0===t&&(t=[]),void 0===n&&(n="localhost"),void 0===o&&(o=9090),new Promise(function(s,u){var l=new c(e,t),f=a.createServer(function(e){e.on("data",function(t){return r.__awaiter(i,void 0,void 0,function(){var n,o,i,a;return r.__generator(this,function(r){switch(r.label){case 0:n=t.toString(),o=JSON.parse(n),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l.render(o)];case 2:return i=r.sent(),e.write(JSON.stringify({html:i,id:o.id})),[3,4];case 3:return a=r.sent(),e.write(JSON.stringify({html:null,id:o.id,error:a.toString()})),[3,4];case 4:return[2]}})})})});f.listen(o,n),s({close:function(){return f.close()}})})},Object.defineProperty(e,"__esModule",{value:!0})});