!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("@angular/platform-server"),require("@angular/common"),require("@angular/compiler"),require("@nguniversal/aspnetcore-engine/tokens"),require("fs"),require("tslib"),require("@angular/platform-browser"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@nguniversal/aspnetcore-engine",["exports","@angular/core","@angular/platform-server","@angular/common","@angular/compiler","@nguniversal/aspnetcore-engine/tokens","fs","tslib","@angular/platform-browser","rxjs/operators"],r):r(((e=e||self).nguniversal=e.nguniversal||{},e.nguniversal.aspnetcoreEngine={}),e.ng.core,e.ng.platformServer,e.ng.common,e.ng.compiler,e.nguniversal.aspnetcoreEngine.tokens,e.fs,e.tslib,e.ng.platformBrowser,e.rxjs.operators)}(this,function(e,r,t,n,o,i,a,u,s,l){"use strict";
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */var c=function(){function e(){}return e.prototype.get=function(e){return new Promise(function(r,t){a.readFile(e,function(e,n){if(e)return t(e);r(n.toString())})})},e}(),p="app-root",f=new Map;
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
e.ngAspnetCoreEngine=function d(e){if(!e.appSelector)throw new Error("appSelector is required! Pass in \" appSelector: '<"+p+"></"+p+">' \",\n     for your root App component.");p=e.appSelector.substring(1,e.appSelector.indexOf(">"));var a=t.platformDynamicServer().injector.get(r.CompilerFactory).createCompiler([{providers:[{provide:o.ResourceLoader,useClass:c,deps:[]}]}]);return new Promise(function(o,c){try{var d=e.ngModule;if(!d)throw new Error("You must pass in a NgModule or NgModuleFactory to be bootstrapped");e.providers=e.providers||[];var g=e.providers.concat(function m(e,r){return[{provide:i.ORIGIN_URL,useValue:e},{provide:i.REQUEST,useValue:r}]}(e.request.origin,e.request.data.request));(function v(e,t){return new Promise(function(n,o){if(e instanceof r.NgModuleFactory)n(e);else{var i=f.get(e);i?n(i):t.compileModuleAsync(e).then(function(r){f.set(e,r),n(r)},function(e){o(e)})}})}
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */)(d,a).then(function(n){return function o(e,n){var o=function i(e,r){return e([{provide:t.INITIAL_CONFIG,useValue:{document:r.document,url:r.url}},r.extraProviders?r.extraProviders:[]])}(t.platformServer,n);return function a(e,n){return n.then(function(n){if(!n.injector.get(s.ÉµTRANSITION_ID,null))throw new Error("renderModule[Factory]() requires the use of BrowserModule.withServerTransition() to ensure\n  the server-rendered app can be properly bootstrapped into a client app.");return n.injector.get(r.ApplicationRef).isStable.pipe(l.filter(function(e){return e}),l.take(1)).toPromise().then(function(){var r,o,i=e.injector.get(t.PlatformState),a=n.injector.get(t.BEFORE_APP_SERIALIZED,null);if(a)try{for(var s=u.__values(a),l=s.next();!l.done;l=s.next()){var c=l.value;try{c()}catch(e){console.warn("Ignoring BEFORE_APP_SERIALIZED Exception: ",e)}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}var p=i.renderToString();return e.destroy(),{html:p,moduleRef:n}})})}(o,o.bootstrapModuleFactory(e))}
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */(n,{document:e.document||e.appSelector,url:e.url||e.request.absoluteUrl,extraProviders:g})}).then(function(e){var r=function t(e){for(var r=[],t=[],n=[],o=[],i=0;i<e.head.children.length;i++)switch((a=e.head.children[i]).tagName.toUpperCase()){case"SCRIPT":t.push(a.outerHTML);break;case"STYLE":r.push(a.outerHTML);break;case"LINK":o.push(a.outerHTML);break;case"META":n.push(a.outerHTML)}for(i=0;i<e.body.children.length;i++){var a;switch((a=e.body.children[i]).tagName.toUpperCase()){case"SCRIPT":t.push(a.outerHTML);break;case"STYLE":r.push(a.outerHTML);break;case"LINK":o.push(a.outerHTML);break;case"META":n.push(a.outerHTML)}}return{title:e.title,appNode:e.querySelector(p).outerHTML,scripts:t.join("\n"),styles:r.join("\n"),meta:n.join("\n"),links:o.join("\n")}}(e.moduleRef.injector.get(n.DOCUMENT));o({html:r.appNode,moduleRef:e.moduleRef,globals:{styles:r.styles,title:r.title,scripts:r.scripts,meta:r.meta,links:r.links}})},function(e){c(e)})}catch(e){c(e)}})},e.createTransferScript=function g(e){return"<script>window['TRANSFER_CACHE'] = "+JSON.stringify(e)+";<\/script>"},Object.defineProperty(e,"__esModule",{value:!0})});